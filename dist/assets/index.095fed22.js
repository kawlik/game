var t=Object.defineProperty,i=(i,s,e)=>(((i,s,e)=>{s in i?t(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e})(i,"symbol"!=typeof s?s+"":s,e),e);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?i.credentials="include":"anonymous"===t.crossorigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();const s={board:{x:450,y:800},player:{r:20,o:10},spike:{r:15},initial:{player:{x:225,y:550},spikeLeft:{x:15,y:0},spikeRight:{x:435,y:0}},particles:{wind:{color:"rgba( 0, 0, 0, 0.1 )",count:20,r:300},trace:{color:0,count:50,r:5}},color:{background:"#fefefe",player:"#ff5544",spike:"#bbbbbb"},difficulty:{easy:300,medium:225,hard:150}},e=()=>Boolean(Math.floor(2*Math.random())),r=(t,i)=>(t>i&&([t,i]=[i,t]),Math.floor(Math.random()*(i-t+1))+t);class h{constructor(t,s,e,r){i(this,"draw",(t=>{throw new Error("Draw function not implemented!")})),i(this,"update",((t,i,s)=>{this.x=t,this.y=i,this.r=s})),this.x=t,this.y=s,this.r=e,this.color=r}}class l extends h{constructor(t,s,e,r){super(t,s,e,r),i(this,"draw",(t=>{const{x:i,y:s,r:e}=this,r=e/2;t.fillStyle=this.color,t.beginPath(),t.moveTo(i-e,s-r),t.arcTo(i-e,s-e,i+e,s-e,r),t.arcTo(i+e,s-e,i+e,s+e,r),t.arcTo(i+e,s+e,i-e,s+e,r),t.arcTo(i-e,s+e,i-e,s-e,r),t.closePath(),t.fill()})),i(this,"changeSide",((t,i,s)=>{(t||this.x!==i)&&(t&&this.x===s||(t||(this.x-=2*this.r),t&&(this.x+=2*this.r),this.x<i&&(this.x=i),this.x>s&&(this.x=s)))}))}}class a extends h{constructor(t,s,e,r){super(t,s,e,r),i(this,"draw",(t=>{const{x:i,y:s,r:e}=this;t.fillStyle=this.color,t.beginPath(),t.moveTo(i-e,s-e),t.lineTo(i+e,s),t.lineTo(i-e,s+e),t.lineTo(i-e,s-e),t.closePath(),t.fill()})),this.passed=!1}}class c extends h{constructor(t,s,e,r){super(t,s,e,r),i(this,"draw",(t=>{const{x:i,y:s,r:e}=this;t.fillStyle=this.color,t.beginPath(),t.moveTo(i+e,s-e),t.lineTo(i-e,s),t.lineTo(i+e,s+e),t.lineTo(i+e,s-e),t.closePath(),t.fill()})),this.passed=!1}}class o extends h{constructor(t,s,e,h,l,a){super(t,s,e,h),i(this,"init",(()=>{this.particles=new Array(this.count);for(let t=0;t<this.count;t++)this.particles[t]={x:r(0,this.x),y:r(-this.y,this.y),r:r(this.r/4,this.r),speed:(2*Math.random()+1)/2}})),i(this,"update",((t,i,s)=>{this.speed=s;for(let e=0;e<this.particles.length;e++)this.particles[e].y+=this.speed*this.particles[e].speed,this.particles[e].y>this.particles[e].r+this.y&&(this.particles[e].y=-this.y)})),i(this,"draw",(t=>{for(let i=0;i<this.particles.length;i++)t.beginPath(),t.lineWidth=.2,t.fillStyle=this.color,t.moveTo(this.particles[i].x,this.particles[i].y),t.lineTo(this.particles[i].x,this.particles[i].y+this.particles[i].r),t.stroke()})),this.count=l,this.speed=a,this.particles=null,this.init()}}class n extends h{constructor(t,s,e,h,l){super(t,s,e,h),i(this,"init",(()=>{this.particles=new Array(this.count),this.color+=r(0,360)})),i(this,"update",((t,i,s)=>{this.particles.unshift({x:t+r(0,20)-10,y:i+this.r+r(10,50),r:r(this.r,1.5*this.r)});for(let e=0;e<this.particles.length;e++)this.particles[e]&&(this.particles[e].r+=.05,this.particles[e].y+=s);this.particles.splice(this.count),this.color+=s/(10*Math.log1p(s))})),i(this,"draw",(t=>{for(let i=0;i<this.particles.length;i++)this.particles[i]&&(t.beginPath(),t.fillStyle=`hsla( ${this.color}, 100%, 50%, ${(this.count+1)/(i+1)*.2} )`,t.arc(this.particles[i].x,this.particles[i].y,this.particles[i].r,0,2*Math.PI),t.fill())})),this.count=l,this.particles,this.init()}}class p{constructor(t,r=s.difficulty.medium){i(this,"init",(()=>{this.cvs=document.querySelector(this.selector),this.cvs&&(this.cvs.width=this.x=s.board.x,this.cvs.height=this.y=s.board.y,this.ctx=this.cvs.getContext("2d"),document.addEventListener("click",this.changePlayerSide),this.setUp())})),i(this,"setUp",(()=>{const{player:t,particles:i,color:r,initial:h}=s;this.player=new l(h.player.x,h.player.y,t.r,r.player),this.playerSide=e(),this.spikes=new Array,this.spikeSpeed=1,this.spikeCount=0,this.particles=new Array,this.particles.push(new o(this.x,this.y,i.wind.r,i.wind.color,i.wind.count,this.spikeSpeed)),this.particles.push(new n(this.x+2*t.r,this.y,i.trace.r,i.trace.color,i.trace.count)),this.spikeCount=0,this.spikeSpeed=1,this.gameScore=0,this.activeGame=!1})),i(this,"update",(()=>{this.player.changeSide(this.playerSide,this.player.r,this.x-this.player.r);const t=this.spikes[0].y-this.difficulty;t>0&&this.addNewSpike(t),this.spikes.splice(10);for(let i=0;i<this.spikes.length;i++)this.spikes[i].y+=this.spikeSpeed;for(let i=0;i<this.particles.length;i++)this.particles[i].update(this.player.x,this.player.y,this.spikeSpeed);this.calcScore()})),i(this,"draw",(()=>{this.drawBoard(this.ctx);for(let t=0;t<this.particles.length;t++)this.particles[t].draw(this.ctx);this.player.draw(this.ctx);for(let t=0;t<this.spikes.length;t++)this.spikes[t].draw(this.ctx)})),i(this,"changePlayerSide",(()=>{this.playerSide=!this.playerSide})),i(this,"getScore",(()=>this.gameScore)),i(this,"isCollision",(()=>{let t=!1;for(let i=0;i<this.spikes.length;i++){const s=this.player.r+this.spikes[i].r;Math.sqrt((this.player.x-this.spikes[i].x)**2+(this.player.y-this.spikes[i].y)**2)<s-Math.log(s)&&(t=!0)}return t})),i(this,"start",(()=>{this.setUp(),this.addNewSpike(),this.activeGame=!0})),i(this,"stop",(()=>{this.activeGame=!1})),i(this,"addNewSpike",((t=0)=>{const{initial:i,spike:r,color:h}=s,l=e();l||this.spikes.unshift(new a(i.spikeLeft.x,i.spikeLeft.y+t,r.r,h.spike)),l&&this.spikes.unshift(new c(i.spikeRight.x,i.spikeRight.y+t,r.r,h.spike)),this.spikeCount++,this.spikeSpeed=2+50/Math.PI*Math.atan(this.spikeCount/100)})),i(this,"drawBoard",(t=>{t.clearRect(0,0,this.x,this.y),t.fillStyle=s.color.background,t.fillRect(0,0,this.x,this.y)})),i(this,"calcScore",(()=>{for(let t=0;t<this.spikes.length;t++)!this.spikes[t].passed&&this.spikes[t].y>this.player.y+this.player.r&&(this.spikes[t].passed=!0,this.gameScore++)})),this.selector=t,this.difficulty=r,this.cvs=null,this.ctx=null,this.x=null,this.y=null,this.player=null,this.spikes=null,this.particles=null,this.playerSide=null,this.spikeSpeed=null,this.spikeCount=null,this.activeGame=null,this.gameScore=null}}class d{constructor(t){i(this,"init",(()=>{if(this.elem=document.querySelector(this.selector),this.elem){const t=document.createElement("div"),i=document.createElement("div");t.classList.add("preRef","currScore"),i.classList.add("preRef","highScore"),t.innerHTML="now",i.innerHTML="high",this.currScoreRef=document.createElement("span"),this.highScoreRef=document.createElement("span"),this.currScoreRef.classList.add("ref"),this.highScoreRef.classList.add("ref"),t.append(this.currScoreRef),i.append(this.highScoreRef),this.elem.append(t),this.elem.append(i),this.setUp(),this.update()}})),i(this,"setUp",(()=>{this.currScoreVal=0,this.highScoreVal=this.readHighScore()})),i(this,"update",((t=0)=>{this.currScoreVal=t,this.currScoreRef.textContent=this.currScoreVal,this.highScoreRef.textContent=this.highScoreVal,this.currScoreVal>this.readHighScore()&&(this.highScoreVal=this.currScoreVal,this.saveHighScore())})),i(this,"readHighScore",(()=>{const t=parseInt(localStorage.spikeHighScore,10);return Number.isInteger(t)?t:0})),i(this,"saveHighScore",(()=>{localStorage.spikeHighScore=this.highScoreVal})),this.selector=t,this.elem=null,this.currScoreRef=null,this.highScoreRef=null,this.currScoreVal=null,this.highScoreVal=null}}class u{constructor(t,s){i(this,"init",(()=>{this.elem=document.querySelector(this.selector),this.elem&&(this.btnConfig=document.createElement("button"),this.btnStart=document.createElement("button"),this.btnConfig.classList.add("material-icons","config"),this.btnStart.classList.add("material-icons","start"),this.btnConfig.innerHTML="settings",this.btnStart.innerHTML="play_circle",this.btnStart.addEventListener("click",this.handleStart),this.elem.append(this.btnConfig),this.elem.append(this.btnStart))})),i(this,"handleStart",(()=>{this.elem.classList.add("hidden"),this.btnConfig.disabled=!0,this.btnStart.disabled=!0,this.startCallback()})),i(this,"restore",(()=>{this.elem.classList.remove("hidden"),this.btnConfig.disabled=!1,this.btnStart.disabled=!1})),this.selector=t,this.startCallback=s,this.elem=null,this.btnConfig=null,this.btnStart=null}}(new class{constructor(){i(this,"init",(()=>{this.board.init(),this.score.init(),this.interface.init(),this.board.draw()})),i(this,"startAnimate",(()=>{this.board.start();const t=()=>{this.requestID=requestAnimationFrame(t),this.board.update(),this.board.draw(),this.score.update(this.board.getScore()),this.board.isCollision()&&this.stopAnimate()};this.requestID=requestAnimationFrame(t)})),i(this,"stopAnimate",(()=>{this.board.stop(),this.score.setUp(),this.interface.restore(),cancelAnimationFrame(this.requestID)})),this.requestID=null,this.board=new p("#board"),this.score=new d("#score"),this.interface=new u("#interface",this.startAnimate)}}).init();
