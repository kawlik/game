var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const s={board:{x:450,y:800},player:{r:20,o:10},spike:{r:15},initial:{player:{x:225,y:550},spikeLeft:{x:15,y:0},spikeRight:{x:435,y:0}},particles:{wind:{color:"rgba( 0, 0, 0, 0.1 )",count:20,r:300},trace:{color:0,count:50,r:5}},color:{background:"#fefefe",player:"#ff5544",spike:"#bbbbbb"},difficulty:{easy:350,medium:275,hard:200},state:{difficulty:null,playerColor:null,drawParticles:!0,useSmothRender:!0}},i=()=>Boolean(Math.floor(2*Math.random())),r=(t,e)=>(t>e&&([t,e]=[e,t]),Math.floor(Math.random()*(e-t+1))+t);class l{constructor(t,s,i,r){e(this,"draw",(t=>{throw new Error("Draw function not implemented!")})),e(this,"update",((t,e,s)=>{this.x=t,this.y=e,this.r=s})),this.x=t,this.y=s,this.r=i,this.color=r}}class a extends l{constructor(t,s,i,r){super(t,s,i,r),e(this,"draw",(t=>{const{x:e,y:s,r:i}=this,r=i/2;t.fillStyle=this.color,t.beginPath(),t.moveTo(e-i,s-r),t.arcTo(e-i,s-i,e+i,s-i,r),t.arcTo(e+i,s-i,e+i,s+i,r),t.arcTo(e+i,s+i,e-i,s+i,r),t.arcTo(e-i,s+i,e-i,s-i,r),t.closePath(),t.fill()})),e(this,"changeSide",((t,e,s)=>{(t||this.x!==e)&&(t&&this.x===s||(t||(this.x-=2*this.r),t&&(this.x+=2*this.r),this.x<e&&(this.x=e),this.x>s&&(this.x=s)))}))}}class h extends l{constructor(t,s,i,r){super(t,s,i,r),e(this,"draw",(t=>{const{x:e,y:s,r:i}=this;t.fillStyle=this.color,t.beginPath(),t.moveTo(e-i,s-i),t.lineTo(e+i,s),t.lineTo(e-i,s+i),t.lineTo(e-i,s-i),t.closePath(),t.fill()})),this.passed=!1}}class o extends l{constructor(t,s,i,r){super(t,s,i,r),e(this,"draw",(t=>{const{x:e,y:s,r:i}=this;t.fillStyle=this.color,t.beginPath(),t.moveTo(e+i,s-i),t.lineTo(e-i,s),t.lineTo(e+i,s+i),t.lineTo(e+i,s-i),t.closePath(),t.fill()})),this.passed=!1}}class n extends l{constructor(t,s,i,l,a,h){super(t,s,i,l),e(this,"init",(()=>{this.particles=new Array(this.count);for(let t=0;t<this.count;t++)this.particles[t]={x:r(0,this.x),y:r(-this.y,this.y),r:r(this.r/4,this.r),speed:(2*Math.random()+1)/2}})),e(this,"update",((t,e,s)=>{this.speed=s;for(let i=0;i<this.particles.length;i++)this.particles[i].y+=this.speed*this.particles[i].speed,this.particles[i].y>this.particles[i].r+this.y&&(this.particles[i].y=-this.y)})),e(this,"draw",(t=>{for(let e=0;e<this.particles.length;e++)t.beginPath(),t.lineWidth=.2,t.fillStyle=this.color,t.moveTo(this.particles[e].x,this.particles[e].y),t.lineTo(this.particles[e].x,this.particles[e].y+this.particles[e].r),t.stroke()})),this.count=a,this.speed=h,this.particles=null,this.init()}}class c extends l{constructor(t,s,i,l,a){super(t,s,i,l),e(this,"init",(()=>{this.particles=new Array(this.count),this.color+=r(0,360)})),e(this,"update",((t,e,s)=>{this.particles.unshift({x:t+r(0,20)-10,y:e+this.r+r(10,50),r:r(this.r,1.5*this.r)});for(let i=0;i<this.particles.length;i++)this.particles[i]&&(this.particles[i].r+=.05,this.particles[i].y+=s);this.particles.splice(this.count),this.color+=s/(10*Math.log1p(s))})),e(this,"draw",(t=>{for(let e=0;e<this.particles.length;e++)this.particles[e]&&(t.beginPath(),t.fillStyle=`hsla( ${this.color}, 100%, 50%, ${(this.count+1)/(e+1)*.2} )`,t.arc(this.particles[e].x,this.particles[e].y,this.particles[e].r,0,2*Math.PI),t.fill())})),this.count=a,this.particles,this.init()}}class d{constructor(t){e(this,"init",(()=>{this.cvs=document.querySelector(this.selector),this.cvs&&(this.cvs.width=this.x=s.board.x,this.cvs.height=this.y=s.board.y,this.ctx=this.cvs.getContext("2d"),document.addEventListener("click",this.changePlayerSide),this.setUp())})),e(this,"setUp",(()=>{const{player:t,particles:e,color:r,difficulty:l,initial:h,state:o}=s;this.player=new a(h.player.x,h.player.y,t.r,o.playerColor||r.player),this.playerSide=i(),this.spikes=new Array,this.spikeSpeed=1,this.spikeCount=0,this.particles=new Array,this.particles.push(new n(this.x,this.y,e.wind.r,e.wind.color,e.wind.count,this.spikeSpeed)),this.particles.push(new c(this.x+2*t.r,this.y,e.trace.r,e.trace.color,e.trace.count)),this.spikeCount=0,this.spikeSpeed=1,this.gameScore=0,this.difficulty=o.difficulty||l.medium,this.activeGame=!1,this.draw()})),e(this,"update",(()=>{this.player.changeSide(this.playerSide,this.player.r,this.x-this.player.r);const t=this.spikes[0].y-this.difficulty;t>0&&this.addNewSpike(t),this.spikes.splice(10);for(let e=0;e<this.spikes.length;e++)this.spikes[e].y+=this.spikeSpeed;for(let e=0;e<this.particles.length;e++)this.particles[e].update(this.player.x,this.player.y,this.spikeSpeed);this.calcScore()})),e(this,"draw",(()=>{if(this.drawBoard(this.ctx),s.state.drawParticles)for(let t=0;t<this.particles.length;t++)this.particles[t].draw(this.ctx);this.player.draw(this.ctx);for(let t=0;t<this.spikes.length;t++)this.spikes[t].draw(this.ctx)})),e(this,"changePlayerSide",(()=>{this.playerSide=!this.playerSide})),e(this,"getScore",(()=>this.gameScore)),e(this,"isCollision",(()=>{let t=!1;for(let e=0;e<this.spikes.length;e++){const s=this.player.r+this.spikes[e].r;Math.sqrt((this.player.x-this.spikes[e].x)**2+(this.player.y-this.spikes[e].y)**2)<s-Math.log(s)&&(t=!0)}return t})),e(this,"start",(()=>{this.setUp(),this.addNewSpike(),this.activeGame=!0})),e(this,"stop",(()=>{this.activeGame=!1})),e(this,"addNewSpike",((t=0)=>{const{initial:e,spike:r,color:l}=s,a=i();a||this.spikes.unshift(new h(e.spikeLeft.x,e.spikeLeft.y+t,r.r,l.spike)),a&&this.spikes.unshift(new o(e.spikeRight.x,e.spikeRight.y+t,r.r,l.spike)),this.spikeCount++,this.spikeSpeed=2+50/Math.PI*Math.atan(this.spikeCount/100)})),e(this,"drawBoard",(t=>{t.clearRect(0,0,this.x,this.y),t.fillStyle=s.color.background,t.fillRect(0,0,this.x,this.y)})),e(this,"calcScore",(()=>{for(let t=0;t<this.spikes.length;t++)!this.spikes[t].passed&&this.spikes[t].y>this.player.y+this.player.r&&(this.spikes[t].passed=!0,this.gameScore++)})),this.selector=t,this.cvs=null,this.ctx=null,this.x=null,this.y=null,this.player=null,this.spikes=null,this.particles=null,this.playerSide=null,this.spikeSpeed=null,this.spikeCount=null,this.difficulty=null,this.activeGame=null,this.gameScore=null}}class p{constructor(t){e(this,"init",(()=>{if(this.elem=document.querySelector(this.selector),this.elem){const t=document.createElement("div"),e=document.createElement("div");t.classList.add("preRef","currScore"),e.classList.add("preRef","highScore"),t.innerHTML="now",e.innerHTML="high",this.currScoreRef=document.createElement("span"),this.highScoreRef=document.createElement("span"),this.currScoreRef.classList.add("ref"),this.highScoreRef.classList.add("ref"),t.append(this.currScoreRef),e.append(this.highScoreRef),this.elem.append(t),this.elem.append(e),this.setUp(),this.update()}})),e(this,"setUp",(()=>{this.currScoreVal=0,this.highScoreVal=this.readHighScore()})),e(this,"update",((t=0)=>{this.currScoreVal=t,this.currScoreRef.textContent=this.currScoreVal,this.highScoreRef.textContent=this.highScoreVal,this.currScoreVal>this.readHighScore()&&(this.highScoreVal=this.currScoreVal,this.saveHighScore())})),e(this,"readHighScore",(()=>{const t=parseInt(localStorage.spikeHighScore,10);return Number.isInteger(t)?t:0})),e(this,"saveHighScore",(()=>{localStorage.spikeHighScore=this.highScoreVal})),this.selector=t,this.elem=null,this.currScoreRef=null,this.highScoreRef=null,this.currScoreVal=null,this.highScoreVal=null}}class u{constructor(t,i){e(this,"init",(()=>{if(this.elem=document.querySelector(this.selector),this.elem){this.btnClose=document.createElement("button"),this.btnClose.addEventListener("click",this.setHidden),this.btnClose.classList.add("material-icons","btnClose"),this.btnClose.innerHTML="cancel",this.btnReset=document.createElement("button"),this.btnReset.addEventListener("click",this.setReset),this.btnReset.classList.add("material-icons","btnReset"),this.btnReset.innerHTML="replay";const t=document.createElement("label"),e=document.createElement("label"),i=document.createElement("label"),r=document.createElement("label");t.classList.add("preRef","difficulty"),e.classList.add("preRef","playerColor"),i.classList.add("preRef","drawParticles"),r.classList.add("preRef","useSmothRender"),t.innerHTML="difficulty",e.innerHTML="player color",i.innerHTML="draw particles",r.innerHTML="use smoth render",this.playerColorRef=document.createElement("input"),this.drawParticlesRef=document.createElement("input"),this.useSmothRenderRef=document.createElement("input"),this.difficultyRef=document.createElement("select");const l=document.createElement("option");l.value=s.difficulty.easy,l.innerHTML="easy";const a=document.createElement("option");a.value=s.difficulty.medium,a.innerHTML="medium";const h=document.createElement("option");h.value=s.difficulty.hard,h.innerHTML="hard",this.difficultyRef.append(l),this.difficultyRef.append(a),this.difficultyRef.append(h),this.playerColorRef.type="color",this.drawParticlesRef.type="checkbox",this.useSmothRenderRef.type="checkbox",this.difficultyRef.classList.add("ref"),this.playerColorRef.classList.add("ref"),this.drawParticlesRef.classList.add("ref"),this.useSmothRenderRef.classList.add("ref"),t.append(this.difficultyRef),e.append(this.playerColorRef),i.append(this.drawParticlesRef),r.append(this.useSmothRenderRef),this.elem.append(t),this.elem.append(e),this.elem.append(i),this.elem.append(r),this.elem.append(this.btnClose),this.elem.append(this.btnReset),this.setUp(),this.update()}})),e(this,"setUp",(()=>{this.difficultyRef.addEventListener("change",this.handleChangeDifficulty),this.playerColorRef.addEventListener("change",this.handleChangePlayerColor),this.drawParticlesRef.addEventListener("change",this.handleChangeDrawParticlesVal),this.useSmothRenderRef.addEventListener("change",this.handleChangeUseSmothRenderVal),this.readState(),this.setProperValue()})),e(this,"update",(()=>{s.state.difficulty=this.difficultyVal,s.state.playerColor=this.playerColorVal,s.state.drawParticles=this.drawParticlesVal,s.state.useSmothRender=this.useSmothRenderVal,this.saveState(),this.setProperValue(),this.boardSetUpCallback()})),e(this,"setVisible",(()=>{this.elem.classList.add("visible")})),e(this,"setHidden",(()=>{this.elem.classList.remove("visible")})),e(this,"setReset",(()=>{this.difficultyVal=s.difficulty.medium,this.playerColorVal=s.color.player,this.drawParticlesVal=!0,this.useSmothRenderVal=!0,this.update()})),e(this,"handleChangeDifficulty",(t=>{this.difficultyVal=parseInt(t.target.value),this.update()})),e(this,"handleChangePlayerColor",(t=>{this.playerColorVal=t.target.value,this.update()})),e(this,"handleChangeDrawParticlesVal",(t=>{this.drawParticlesVal=Boolean(t.target.checked),this.update()})),e(this,"handleChangeUseSmothRenderVal",(t=>{this.useSmothRenderVal=Boolean(t.target.checked),this.update()})),e(this,"setProperValue",(()=>{[...this.difficultyRef.options].forEach((t=>{t.selected=+t.value===this.difficultyVal})),this.playerColorRef.value=this.playerColorVal,this.drawParticlesRef.checked=this.drawParticlesVal,this.useSmothRenderRef.checked=this.useSmothRenderVal})),e(this,"readState",(()=>{const t=void 0===localStorage.difficulty?s.difficulty.medium:parseInt(localStorage.difficulty),e=void 0===localStorage.playerColor?s.color.player:localStorage.playerColor,i=void 0===localStorage.drawParticles?s.state.drawParticles:Boolean(localStorage.drawParticles),r=void 0===localStorage.useSmothRender?s.state.useSmothRender:Boolean(localStorage.useSmothRender);this.difficultyVal=t,this.playerColorVal=e,this.drawParticlesVal=i,this.useSmothRenderVal=r})),e(this,"saveState",(()=>{localStorage.difficulty=this.difficultyVal,localStorage.playerColor=this.playerColorVal,localStorage.drawParticles=this.drawParticlesVal,localStorage.useSmothRender=this.useSmothRenderVal})),this.selector=t,this.boardSetUpCallback=i,this.elem=null,this.btnClose=null,this.btnReset=null,this.difficultyRef=null,this.playerColorRef=null,this.drawParticlesRef=null,this.useSmothRenderRef=null,this.difficultyVal=null,this.playerColorVal=null,this.drawParticlesVal=null,this.useSmothRenderVal=null}}class f{constructor(t,s,i){e(this,"init",(()=>{this.elem=document.querySelector(this.selector),this.elem&&(this.btnConfig=document.createElement("button"),this.btnStart=document.createElement("button"),this.btnConfig.classList.add("material-icons","config"),this.btnStart.classList.add("material-icons","start"),this.btnConfig.innerHTML="settings",this.btnStart.innerHTML="play_circle",this.btnConfig.addEventListener("click",this.handleConfig),this.btnStart.addEventListener("click",this.handleStart),this.elem.append(this.btnConfig),this.elem.append(this.btnStart))})),e(this,"handleConfig",(()=>{this.state.setVisible()})),e(this,"handleStart",(()=>{this.elem.classList.add("hidden"),this.btnConfig.disabled=!0,this.btnStart.disabled=!0,this.startCallback()})),e(this,"restore",(()=>{this.elem.classList.remove("hidden"),this.btnConfig.disabled=!1,this.btnStart.disabled=!1})),this.selector=t,this.startCallback=i,this.state=s,this.elem=null,this.btnConfig=null,this.btnStart=null}}(new class{constructor(){e(this,"init",(()=>{this.board.init(),this.score.init(),this.state.init(),this.interface.init(),this.board.draw()})),e(this,"startAnimate",(()=>{this.board.start();const t=()=>{s.state.useSmothRender&&(this.requestID=requestAnimationFrame(t)),this.board.update(),this.board.draw(),this.score.update(this.board.getScore()),this.board.isCollision()&&this.stopAnimate()};s.state.useSmothRender?this.requestID=requestAnimationFrame(t):this.requestID=setInterval(t,1e3/60)})),e(this,"stopAnimate",(()=>{this.board.stop(),this.score.setUp(),this.interface.restore(),s.state.useSmothRender?cancelAnimationFrame(this.requestID):clearInterval(this.requestID)})),this.requestID=null,this.board=new d("#board"),this.score=new p("#score"),this.state=new u("#state",this.board.setUp),this.interface=new f("#interface",this.state,this.startAnimate)}}).init();
